---
layout: post
title: Events visualization with EvenDrops and KoExtensions (D3 and Knockout)
date: '2014-11-02T15:40:00.000-08:00'
author: Jan Fajfr
tags:
- MVVM
- JavaScript
- Data
modified_time: '2014-11-10T08:44:58.407-08:00'
thumbnail: http://1.bp.blogspot.com/-Uq06dPrA0nk/VFa78Ko291I/AAAAAAAAEAE/AAyc-A9AhCY/s72-c/eventDrops.PNG
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-8504375191575189411
blogger_orig_url: http://hoonzis.blogspot.com/2014/11/events-visualization-with-evendrops-and.html
---

<p>I have recently needed to visualize a set of events which occurred within a certain interval. Each event would have couple parameters and there would be multiple event lines. Let's say that you want to visualize the occurences of car sales in couple countries. For each sale you would also want to visualize the price and the mark of the sold car. Before writing everything from scratch, I have found <a href="https://github.com/marmelab/EventDrops">EventDrops</a> project which responded to the majority of my requirements. It had just one flaw and that is that there is no way to chart another characteristics for each event.</p> <p>I have decided to add such possibility and since I am using KnockoutJS and binding to create all of my charts I have also decided to add EventDrops to my <a href="https://github.com/hoonzis/KoExtensions">KoExtensions</a> project - in order to make it's usage simplier. The resulting chart looks like this:</p> <div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Uq06dPrA0nk/VFa78Ko291I/AAAAAAAAEAE/AAyc-A9AhCY/s1600/eventDrops.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-Uq06dPrA0nk/VFa78Ko291I/AAAAAAAAEAE/AAyc-A9AhCY/s320/eventDrops.PNG" /></a></div> <p>This <a href="https://github.com/hoonzis/KoExtensions/blob/master/testpages/EventDrops.html">example</a> is available on GitHub as part of KoExtensions.</p> <p>What I have added to the original event drops are the following possibilities:</p> <ul><li>The chart now accepts generic collection instead of just a collection of dates. The developer in turn has to specify a function to get the date for each item</li><li>The size of the event is dynamic</li><li>The color of the event is dynamic</li><li>Better possibility to provide a however action</li><li>The size of the event can use logarithmic or linear scale</li><li>Everything is available as KnockoutJS binding</li></ul>   The html is now really straightforward:  <pre class="prettyprint"><br />&lt;div data-bind="eventDrops: carSales, chartOptions: carSalesOptions"&gt;&lt;/div&gt;<br /></pre> The javascript behind this page contains a bit more to generate the data: <pre class="prettyprint"><br />require(['knockout-3.2.0.debug', 'KoExtensions/koextbindings', 'KoExtensions/Charts/linechart', 'KoExtensions/Charts/piechart', 'KoExtensions/Charts/barchart'], function(ko) {<br /> function createRundomSales(country) {<br />  var event = {};<br />  var marks = ['Audi', 'BMW', 'Peugot', 'Skoda'];<br /><br />  event.name = country;<br />  event.dates = [];<br />  <br />  var endTime = Date.now();<br />  var oneMonth = 30 * 24 * 60 * 60 * 1000;<br />  var startTime = endTime - oneMonth;<br /><br />  var max = Math.floor(Math.random() * 80);<br />  for (var j = 0; j < max; j++) {<br />   var time = Math.floor((Math.random() * oneMonth)) + startTime;<br />   event.dates.push({<br />    timestamp: new Date(time),<br />    carMark: marks[Math.floor(Math.random() * 100) % 4],<br />    price: Math.random() * 100000<br />   });<br />  }<br /><br />  return event;<br /> }<br /><br /><br /> function createSales() {<br />  var sales = [];<br />  var countries = ['France', 'Germany', 'Czech Republic', 'Spain'];<br />  countries.forEach(function(country) {<br />   var countrySales = createRundomSales(country);<br />   sales.push(countrySales);<br />  });<br />  return sales;<br /> }<br /><br /> function TestViewModels() {<br />  var self = this;<br /><br />  self.carSales = ko.observableArray([]);<br />  self.carSales(createSales());<br /><br />  self.carSalesOptions = {<br />   eventColor: function (d) { return d.carMark; },<br />   eventSize: function (d) { return d.price; },<br />   eventDate: function (d) { return d.timestamp; },<br />   start: new Date(2014, 8, 1)<br />  };<br /> }<br /><br /> var vm = new TestViewModels();<br /><br /> ko.applyBindings(vm);<br />});<br /></pre> <p>In this example the <b>createSales</b> and <b>createRandomSales</b> methods are just use to get testing data. Once the testing data is generated it is stored to the <b>carSales</b> observable collection. Any time this collection is changed the chart would be updated.</p><p>The sales collection looks a bit like this:</p><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-TdC5QSwU6gk/VFa_ve8kWXI/AAAAAAAAEAQ/2w9F3cFbACE/s1600/eventDropsstruc.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-TdC5QSwU6gk/VFa_ve8kWXI/AAAAAAAAEAQ/2w9F3cFbACE/s320/eventDropsstruc.PNG" /></a></div><p>The <b>carSalesOptions</b> object contains the charting options. These tell to the event drops chart the necessary information to specify how big and which color should be used for the given event.</p>