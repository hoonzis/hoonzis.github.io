---
layout: post
title: Wrong SystemRoot variable causes 0xC0150004
date: '2012-03-04T10:05:00.000-08:00'
author: Jan Fajfr
tags:
- Windows
modified_time: '2012-03-04T10:05:31.222-08:00'
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-3498587474896128605
blogger_orig_url: http://hoonzis.blogspot.com/2012/03/wrong-systemroot-variable-causes.html
---

Last week I had experienced this quite "funny" situation on WinXP machine.<br /><br />When I have run some post-build scripts using Jenkings & Maven I have obtained something like:<br /><br />CMD is not known, not an executable file etc...<br /><br />I took a look at it and I taught to myself - the "SystemRoot" variable is not set! I have to correct this and it will work fine. Actually this is not true, but apparently it Jenkins does some cleaning in the variables, so it might happend, that the scripts runned by Jenkins will not work as you have expected. Anyway that is not the point of my story. So what I did to "correct" the error was to add the following variable to my USER environement variables:<br /><br /><b>SystemRoot = SystemRoot\System32</b><br /><br />I was too quick and too naive. First the SystemRoot had been already defined in the System variables and second the correct path is just C:\Windows. So I have used this recursion to define the varible - in wrong path.<br /><br />When I have saved my master work, I could not execute almost any new program. I have always obtained the following error: <br /><br /><b>0xC0150004</b><br /><br />So after a fast google I have found out, that this error appears when the SystemRoot variable is not correctly set. Cool so how to fix the mistake? You cannot launch any program or system utility at all and you need to correct the environement variable.<br /><br />Well after a wail I have found this solution:<br /><ul><li>Login as another user<br /></li><li>Start the CMD as the user with the wrong environement variable</li><li>Correct the variable using: SET SystemRoot=C:\Windows<br /></li><li>Now you think it is ok, but after a restart you will find out, that the new settings is never taken into account. So do not bother to restart and try the following:<br /></li><li>Run REGEDIT from the CMD which is opened using the account and where ther correct SystemRoot was set. Notice it will run....and before it was failing because regedit is dependent on that SystemRoot variable.<br /></li><li>Find the user variables searching here: HKEY_CURRENT_USER\Environment<br /></li><li>Now correct the SystemRoot variable and voila after restart you can log in again with the "infected account"</li></ul><br /><br /><h2>The moral of the story:</h2><br />Lot of applications (notepad, regedit, explorer, task manager) would not start if the SystemRoot is not set correctly.<br /><br />WinXP will let you set the variable to such a nonsence as: <br /><b>SystemRoot = SystemRoot\System32</b>