---
layout: post
title: JavaScript asynchronously uploading files
date: '2012-02-18T07:21:00.002-08:00'
author: Jan Fajfr
tags:
- JavaScript
- HTML
modified_time: '2014-06-26T14:39:36.304-07:00'
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-7822574463715932634
blogger_orig_url: http://hoonzis.blogspot.com/2012/02/javascript-asynchronously-uploading.html
---

At the beginning I have thought, that it has to be easy; just make a POST to the server using jQuery and the only question is how to get the data. Well I have found out that it is not that easy and googling around I have found there are quite a lot of pre-build components and plugins, which makes it quite difficult to decide for one of those. <br /><h2>Why it is not possible to use simple JavaScript POST?</h2>Because of the security restrictions. The browser is not allowed to post the file content asynchronously. This is however about to change thanks to HTML 5.<br /><br /><h2>Workarounds</h2><ul><li>HTML 5 - has a support for file uploading. Use the <a href="http://dev.w3.org/2006/webapi/FileAPI/">File API</a>. Follow <a href="">this how to.</a> This does not work in current versions of IE (7,8,9).</li><li>Create a hidden iFrame on the page and redirect the return of the post to this iFrame</li><li>Use Flash, Silverlight, or Java applet</li><li>Use some component, or jQuery plugin, which usually makes use of the preceding ones (usually the iFrame hack)</li></ul><br /><h2>jQuery plugins</h2>There are quite few of those:<br /><ul><li><a href="http://www.plupload.com/example_queuewidget.php">Plupload</a></li><li><a href="http://valums.com/ajax-upload/">JqUploader</a></li><li><a href="http://www.uploadify.com/demos/">Uploadify</a></li><li><a href="http://blueimp.github.com/jQuery-File-Upload/">jQuery File Upload</a></li><li><a href="http://malsup.com/jquery/form/#file-upload">jQuery Form Plugin</a></li></ul><br />I have tested <a href="http://blueimp.github.com/jQuery-File-Upload/">jQuery File Upload.</a> Which is cool, comes with nice GUI but at the time of writing this, I have found it little hard to customize. Actually I have struggled to use a simple form, which would upload just one file, instead of the predefined GUI with it's behavior.<br /><br />The second one that I have tested is <a href="http://malsup.com/jquery/form/#file-upload">jQuery Form Plugin</a> which contrary to the previous one, is simple to use in a one file upload scenario. However it does not provide the nice UI, ready for multiple files upload etc...<br /><br /><h2>Using jQuery Form Plugin in ASP.NET</h2><h3>Client side</h3>On the client side you need jQuery and the Plugin js file. Then with one jQuery call you can set up the form, to use the plugin.<br /><pre class="prettyprint"><br />&lt;form id="uploadForm" action="Upload.ashx" method="POST" enctype="multipart/form-data"&gt;<br />  &lt;input type="hidden" name="MAX_FILE_SIZE" value="100000" /&gt;<br />  File:<br />  &lt;input type="file" name="file" /&gt;<br />  &lt;input type="submit" value="Submit" /&gt;<br />&lt;/form&gt;<br /></pre><pre class="prettyprint"><br />$('#uploadForm').ajaxForm({<br />    beforeSubmit: function (a, f, o) {<br />        o.dataType = 'html'<br />    },<br />    success: function (data) {<br />        alert('upload OK:' + data);<br />    }<br />});<br /></pre>The <b>dataType</b> property which is set to <b>'html</b>, specifies to Form Plugin what kind of response should it expect. To check the other options see the documentation.<br /><br />You can see, that the form action is set to "Upload.ashx". This is the server side script, being a Http Handler (in case of ASP.NET application). It could also probably be a WCF service - but let's keep it simple when we can.<br /><h3>Server side</h3>On the server side you have to define a Http Handler which will take care of the upload functionality.<br /><pre class="prettyprint"><br />public class Upload : IHttpHandler<br />{<br />    public void ProcessRequest(HttpContext context)<br />    {<br />        System.Web.HttpPostedFile file = context.Request.Files[0];<br />        String filePath = "Uploads" + "\\" + RandomString(10) + "." + extension;<br />        string linkFile = System.Web.HttpContext.Current.Server.MapPath("~") + filePath;<br /><br />        file.SaveAs(linkFile);<br />        context.Response.StatusCode = 200;<br />        context.Response.Write(filePath);<br />    }<br />}<br /></pre>And that's it. The handler will save the file and send back the address of the file.