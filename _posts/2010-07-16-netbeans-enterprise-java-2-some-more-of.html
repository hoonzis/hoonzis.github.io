---
layout: post
title: J2EE - NetBeans, JSF, Persistence API - 2nd Part
date: '2010-07-16T06:01:00.001-07:00'
author: Jan Fajfr
tags:
- Java
- J2EE
modified_time: '2014-06-27T05:28:06.643-07:00'
thumbnail: http://4.bp.blogspot.com/_fmvjrARTMYo/TD9UvVLJnfI/AAAAAAAAAGw/aXkxFg01ZAI/s72-c/class_diagram.PNG
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-3792458602013198883
blogger_orig_url: http://hoonzis.blogspot.com/2010/07/netbeans-enterprise-java-2-some-more-of.html
---

In the first part I described how to develop a simple page which shows all the "companies" stored in the company table. Now I would like to describe how to add some additional functions  - create new company, edit company's details. If you are interested take a look at the <a href="{{ site.baseurl }}{% post_url 2010-07-14-enterprise-java-netbeans %}"><b>first part</b></a> or directly <a href="https://skydrive.live.com/redir?resid=F8AFB4F072D6DB62!4913"><b>download the source code</b></a>.<br /><h3>Class diagram and actual state</h3>Here is our class diagram.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TD9UvVLJnfI/AAAAAAAAAGw/aXkxFg01ZAI/s1600/class_diagram.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 208px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TD9UvVLJnfI/AAAAAAAAAGw/aXkxFg01ZAI/s320/class_diagram.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494203242529791474" /></a><br />And here the page with some with table containing 2 companies.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TEBlaHdpOwI/AAAAAAAAAHA/QnJTpbwvmgs/s1600/sample_data.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 277px; height: 166px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TEBlaHdpOwI/AAAAAAAAAHA/QnJTpbwvmgs/s320/sample_data.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494503044746394370" /></a><br /><h3>What we will add</h3><br />Now I will add a button to each row of the table, which will direct the page to a site where the user could edit the company details and a second button which will allow creating a new company. Before creating web pages again I will start with defining methods which we will need in Session Beans (the lowest layer) and additional methods and fields in Backing Beans (the middle layer).<br /><h3>New methods in Session Beans</h3><br />In the Session Bean I will add a method called "saveCompany".<br /><pre class="prettyprint"><br />public void saveCompany(Company company) {<br />company = em.merge(company);<br />em.persist(company);<br />}<br /></pre><br />This method will take an instance of "Company" object and will perform a "merge" of this object with object in Persistence Context. If there is already object distinguished by the same ID in the Persistence Context, than the Entity Manager will update the state of the object in Persistence Context. If there is no such a object than a new one will be created (or lets say the new Company will be added to the Persistence Context. Than by calling the "persist" method of Entity Manager the Company will be stored in the database.<br /><h3>Changes in Backing Bean</h3><br />Now the Backing Bean will need some more changes. I will add a field of type "Company" which will represent a Company which is actually showed or edited. Than instead of using a basic collection of type List<company> I will use a class called DataModel, which is a part of JSF Framework and allows me to get the row selected by the user in the GUI.<br /><pre class="prettyprint"><br />public DataModel companiesModel;<br />private Company company;<br />public DataModel getCompaniesModel(){<br />companiesModel = new ListDataModel(getAllCompanies());<br />return companiesModel;<br />}<br /></pre><br />Now when I have the model I am able to get Company object representing the actually selected row. This is show in method "editCompany".<br /><pre class="prettyprint><br />public String editCompany(){<br />  company = (Company)companiesModel.getRowData();<br />  return "edit-company";<br />}<br /></pre><br />You see that the method returns String, concretely "edit-company". That string represents a name of a navigation rule which will be used by  JSF Framework. Basically it means that the user will be redirected to another page which is specified in the faces-config.xml file. That I will show later. First let me put the last 2 new methods in Backing Bean, one for saving and one for creating a new company. Again the methods return String values for navigation purposes, it will all be clear soon :).<br /><pre class="prettyprint"><br />public String saveCompany(){<br />  ssl.saveCompany(company);<br />  return "show-companies";<br />}<br /><br />public String newCompany(){<br />  company = new Company();<br />  return "edit-company";<br />}<br /></pre><br /><h3>New JSF Page to show Company's details</h3><br />Lets create a new JSF JSP page (On the Web Module -> New -> JSF JSP) and call it "company.jsp". This page will be used to specify the company details. The code is quite simple:<br /><pre class="prettyprint"><br />&lt;h1&gt;&lt;h:outputText value="Company Details:"/&gt;&lt;/h1&gt;<br />&lt;h:panelGrid columns="2"&gt;<br />&lt;h:outputText value="Name"/&gt;<br />&lt;h:inputText value="#{sales.company.name}"/&gt;<br />&lt;h:outputText value="Description"/&gt;<br />&lt;h:inputText value="#{sales.company.description}"/&gt;<br />&lt;/h:panelGrid&gt;<br />&lt;h:commandButton id="btnSave" action="#{sales.saveCompany}" value="Save"/&gt;<br />&lt;/h:form&gt;</pre><br />You see that it uses the h:form tag. This tag is basically later rendered as HTML form tag. This TAG has to be present if your page contains buttons or other components that perform some action. You see that the action of a button is binded to the "saveCompany" method of our Backing Bean and the value of the input fields are binded to the "company" members again in the Backing Bean.<br /><h3>Changes to page containing table of companies</h3><br />Now lets do some changes to the "companies.jsp" page - the page containing the table of all companies. I will add a "Edit" button to each row (by defining a new column) and in the bottom of the page I will add a "New" button. Both of these buttons will use method previously defined in the Backing Bean.<br /><pre class="prettyprint"><br />&lt;h:form&gt;<br />&lt;h1&gt;&lt;h:outputText value="Companies List"/&gt;&lt;/h1&gt;<br />&lt;h:dataTable value="#{sales.companiesModel}" var="item"&gt;<br />&lt;h:column&gt;<br />&lt;f:facet name="header"&gt;&lt;h:outputText value="Name"/&gt;&lt;/f:facet&gt;<br />&lt;h:outputText value="#{item.name}"/&gt;<br />&lt;/h:column&gt;<br />&lt;h:column&gt;<br />&lt;f:facet name="header"&gt;&lt;h:outputText value="Description"/&gt;&lt;/f:facet&gt;<br />&lt;h:outputText value="#{item.description}"/&gt;<br />&lt;/h:column&gt;<br />&lt;h:column&gt;<br />&lt;h:commandButton id="btnEdit" action="#{sales.editCompany}" value="Edit"/&gt;<br />&lt;/h:column&gt;<br />&lt;/h:dataTable&gt;<br />&lt;h:commandButton id="btnNew" action="#{sales.newCompany}" value="New"/&gt;<br />&lt;/h:form&gt;<br /></pre><br />Notice, that because there are buttons performing actions I had to surround the whole table by <b>h:form</b> tag.<br /><h3>Changes to faces-config.xml</h3><br />OK - now we have the pages, last step missing is to explain the navigation rules. As I said before these rules are managed by JSF Framework, and are "called" by returning string expression of our Backing Beans methods (editCompany, saveCompany, newCompany). Open the file "faces-config.xml" and in the upper tab select "Page Flow". You will see a diagram of your pages (there should be 3 of them: companies.jsp, company.jsp, index.jsp). Edit the "Page Flow diagram so it will resemble the following one.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_fmvjrARTMYo/TEFosQFIslI/AAAAAAAAAHQ/oeZsBQQFlB4/s1600/page_layout_2.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 182px;" src="http://1.bp.blogspot.com/_fmvjrARTMYo/TEFosQFIslI/AAAAAAAAAHQ/oeZsBQQFlB4/s320/page_layout_2.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494788129808757330" /></a><br />You can change the view to XML and see the XML declaration of these rules (the Page Flow diagram is there just to visualize the navigation rules.<br /><pre class="prettyprint"><br />&lt;navigation-rule&gt;<br />&lt;from-view-id&gt;/companies.jsp&lt;/from-view-id&gt;<br />&lt;navigation-case&gt;<br />&lt;from-outcome&gt;edit-company&lt;/from-outcome&gt;<br />&lt;to-view-id&gt;/company.jsp&lt;/to-view-id&gt;<br />&lt;/navigation-case&gt;<br />&lt;/navigation-rule&gt;<br />&lt;navigation-rule&gt;<br />&lt;from-view-id&gt;/company.jsp&lt;/from-view-id&gt;<br />&lt;navigation-case&gt;<br />&lt;from-outcome&gt;show-companies&lt;/from-outcome&gt;<br />&lt;to-view-id&gt;/companies.jsp&lt;/to-view-id&gt;<br />&lt;/navigation-case&gt;<br />&lt;/navigation-rule&gt;<br /></pre><br />OK now you should be ready to start try out the project. In the "index.jsp" page I added redirect from index page to "companies.jsp" - so you do not have to type the address and it just gets opened after running the project in NetBeans.<br /><pre class="brush: html"><jsp:forward page="matchesList.jsf"/><br /></pre><br /><a href="{{ site.baseurl }}{% post_url 2010-07-14-enterprise-java-netbeans %}"><b>PART 1</b></a><br /><a href="{{ site.baseurl }}{% post_url 2010-07-16-netbeans-enterprise-java-2-some-more-of %}"><b>PART 2</b></a><br /><a href="{{ site.baseurl }}{% post_url 2010-07-29-j2ee-netbeans-jsf-persistence-api-part %}"><b>PART 3</b></a><br />