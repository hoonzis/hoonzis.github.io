---
layout: post
title: J2EE - NetBeans, JSF, Persistence API
date: '2010-07-14T05:52:00.002-07:00'
author: Jan Fajfr
tags:
- Java
- JSF
- J2EE
modified_time: '2014-06-27T05:31:19.661-07:00'
thumbnail: http://2.bp.blogspot.com/_fmvjrARTMYo/TEBmdsdJm-I/AAAAAAAAAHI/ql1vT_46hiY/s72-c/netbeans_start_enterprise.PNG
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-7514540512490015079
blogger_orig_url: http://hoonzis.blogspot.com/2010/07/enterprise-java-netbeans.html
---

<p><b>UPDATE:</b></p><p>This is a very old article from the times, when I was very new to Java world. Nowadays I would probably not recomend looking into JSF and J2EE, but it can serve well someone who decided for these technologies and wants to get started.</p>   I spend most of my time with .NET technologies, but I am aware of that J2EE is very powerful and number one technology in the enterprise application world, so I decided that I should learn some basics of J2EE.<br /><br />You can download the <a href="https://skydrive.live.com/redir?resid=F8AFB4F072D6DB62!4913"><b>source code here.</b></a> The source code contains already implemented the changes described in the <a href="{{ site.baseurl }}{% post_url 2010-07-16-netbeans-enterprise-java-2-some-more-of %}">second part of this post.</a><br /><br />This is a simple tutorial on "How to build simple enterprise web application on top of DB" using Java Persistence API, JSF, NetBeans and Derby Database. We will create application that allows the management of "Companies and their Products".<br /><br /><h3>First you will need:</h3><br />-> NetBeans 6.7.1 + <a href="uml.netbeans.org/">UML tools</a>. I used 6.7.1 because it supported the UML modelling tools with reverse engineer and code generation. The package was not so far ported for the newer versions of NetBeans.<br />-> J2EE<br />-> Application server - I used GlassFish 2.1<br />-> Derby Database (Java DB is SUN's version of this Open Source database)<br /><br />You can just download the NetBeans Bundle which already includes everything. Just keep in mind that it was tested on the 6.7.1/GlassFish 2.1 version and some setting might not work on the newer versions.<br /><br /><h3>Technologies & Recommended Reading</h3><br /><b>Java Persistence API</b> - will help us with Object Relational Mapping - it will transfer the Java Objects to the tables in the database.<br /><b> Entity Bean </b> - represents the object (Company, Product) and its fields (Name, Description) which are later represented as columns in data table.<br /><b> Session Bean </b> - rather represents all the actions which can be done with the Entity Beans (Create new product, List products of company...)<br /><b>JSF</b> - web application framework used to speedup an ease the GUI creation. I use the 1.2 version, which is build on top of JSP (a lower layer technology for building dynamic web apps).<br /><br /><h3>Create the projects</h3><br />In NetBeans select New -> New Project -> Java EE -> Enterprise Application. Later you will be asked to specify Application Server, here you can select the installed GlassFish instance.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_fmvjrARTMYo/TEBmdsdJm-I/AAAAAAAAAHI/ql1vT_46hiY/s1600/netbeans_start_enterprise.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 149px;" src="http://2.bp.blogspot.com/_fmvjrARTMYo/TEBmdsdJm-I/AAAAAAAAAHI/ql1vT_46hiY/s320/netbeans_start_enterprise.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494504205727669218" /></a><br />In the last tab you can specify the names for the EJB and Web Application Module. That is because NetBeans will create two modules. The EJB module will take care of your "Model and Control", the Web Application Module will take care of the "View".<br /><br />If you wish to model you Entity Beans with NetBeans UML tool than select New Project -> UML -> Java-Platform Model -> Finish, and later you can create your Class Diagram.<br /><br /><h3>Start with modelling</h3><br />First we want to create our Entity Beans - objects which represent some real world entities, which will be stored in the database. In our application there are 2: Company and Product. Here is the class diagram which we want to create.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TD9UvVLJnfI/AAAAAAAAAGw/aXkxFg01ZAI/s1600/class_diagram.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 208px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TD9UvVLJnfI/AAAAAAAAAGw/aXkxFg01ZAI/s320/class_diagram.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494203242529791474" /></a><br />From this diagram we can generate the Entity classes. Right click the UML project -> Generate Code. You should obtain following classes:<br /><pre class="prettyprint"><br />public class Company {<br /><br />private int id;<br />private String description;<br />private String name;<br />private List<product> products;<br /><br />public Company () {<br />}<br /><br />public int getId () {<br />return id;<br />}<br /><br />public void setId (int val) {<br />id = val;<br />}<br /><br />public String getName () {<br />return name;<br />}<br /><br />public void setName (String val) {<br />name = val;<br />}<br /><br />public List<product> getProducts() {<br />return products;<br />}<br /><br />public void setProducts(List<product> products) {<br />this.products = products;<br />}<br /><br />public String getDescription () {<br />return description;<br />}<br /><br />public void setDescription (String val) {<br />this.description = val;<br />}<br />}<br /></pre><br /><pre class="prettyprint"><br />public class Product {<br /><br />private int id;<br />private String description;<br />private String name;<br /><br />public Product () {<br />}<br /><br />public String getDescription () {<br />return description;<br />}<br /><br />public void setDescription (String val) {<br />description = val;<br />}<br /><br />public int getId () {<br />return id;<br />}<br /><br />public void setId (int val) {<br />id = val;<br />}<br /><br />public String getName () {<br />return name;<br />}<br /><br />public void setName (String val) {<br />name = val;<br />}<br />}<br /></pre><br /><br />Also you can write the classes and use the Reverse Engineer to obtain the class diagram.<br /><br /><h3>Creating Entity Beans from classes</h3><br />To convert the the class to Entity Beans you have to do two simple steps - <b>add annotations and implement the Serializable interface</b>.<br /><br /><pre class="prettyprint"><br />public class Company implements Serializable {<br /><br />@Id<br />@GeneratedValue(strategy=GenerationType.IDENTITY)<br />@Column(name="companyID",nullable=false)<br />private int id;<br /><br />@Column(name="companyDescription")<br />private String description;<br /><br />@Column(name="companyName")<br />private String name;<br /><br />@ManyToMany<br />private List<product> products;<br /><br />...and all the setters and getter...<br />}<br /></pre><br /><br />It is quite self-explanatory. The class has to be annotated as @Entity, and has to have at least one @Id field. Then we can specify the name of the column which will be created in the database, and also strategy for generating the IDs value.<br /><br />You will notice that there will the NetBeans light bulb telling you that there is no Persistence Unit - now we will create one.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TD3pusYq19I/AAAAAAAAAGA/pppUYb-iHAM/s1600/image_persistance_unit.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 166px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TD3pusYq19I/AAAAAAAAAGA/pppUYb-iHAM/s320/image_persistance_unit.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493804108859758546" /></a><br /><br /><h3>Creating the Persistence Unit</h3><br />Persistence Unit will perform the object - relational mapping for us. To create one we will first create a database.<br />On the "Services" pane localize Databases -> Java DB -> Create Database and specify the demanded details.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_fmvjrARTMYo/TD3pbm9BDBI/AAAAAAAAAF4/5-_Deqqw1Os/s1600/create_database.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 156px;" src="http://3.bp.blogspot.com/_fmvjrARTMYo/TD3pbm9BDBI/AAAAAAAAAF4/5-_Deqqw1Os/s320/create_database.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493803780984081426" /></a><br />Now when we have the Database, we can create Database Connection which will be used by the Persistence Unit to connect to the DB.<br /><b>Databases -> New Connection.</b><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_fmvjrARTMYo/TD3sm9MAX6I/AAAAAAAAAGI/jBuR7O93GCw/s1600/new_connection.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 157px;" src="http://3.bp.blogspot.com/_fmvjrARTMYo/TD3sm9MAX6I/AAAAAAAAAGI/jBuR7O93GCw/s320/new_connection.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493807274465976226" /></a><br /><br />Now go back and right click EJB Module of you application and select New -> Persistence Unit.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TD3tsFjESQI/AAAAAAAAAGQ/jMwEPSjBY2E/s1600/new_persistance+unit.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 183px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TD3tsFjESQI/AAAAAAAAAGQ/jMwEPSjBY2E/s320/new_persistance+unit.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493808462121158914" /></a><br /><br />Before we continue with Session Beans we will prepare a Named Query. Named queries are static queries which are later compiled to SQL and used by Persistence Unit. We will use a simple queries getting all the companies in the table. We place the query above the class definition.<br /><br /><pre class="prettyprint"><br />@Entity<br />@NamedQuery(<br />name="Company.getAllCompanies",<br />query="SELECT c FROM Company c"<br />)<br />public class Company implements Serializable {<br /><br />}<br /></pre><br /><br />Now that you have finished the Persistance Unit you can try to deploy the project. Of course there is no functionality so far created, but during the deployment the database should be created for you. You can check the resulted database in the Services tab.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_fmvjrARTMYo/TEBjoI_WSVI/AAAAAAAAAG4/T5ODHLULHvY/s1600/database_structure.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 222px; height: 320px;" src="http://1.bp.blogspot.com/_fmvjrARTMYo/TEBjoI_WSVI/AAAAAAAAAG4/T5ODHLULHvY/s320/database_structure.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494501086651107666" /></a><h3>Session Beans</h3><br />Now we will create the Session Bean, which will provide method and actions which we can perform with our Entity Beans.<br />Go to Enterprise Beans -> New -> Session Bean, than specify the package and leave the standard settings.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_fmvjrARTMYo/TD4HONy-sYI/AAAAAAAAAGY/64PRH9ir9tw/s1600/session_bean.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 191px;" src="http://3.bp.blogspot.com/_fmvjrARTMYo/TD4HONy-sYI/AAAAAAAAAGY/64PRH9ir9tw/s320/session_bean.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493836536241631618" /></a><br />You can notice that the newly created Bean implements interface ending with "Local". <br />Now we will add the first method which will return all the companies in the database. NetBeans tells you how to do this - Context Menu -> Insert Code -> Add Bussiness Method.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_fmvjrARTMYo/TD4H6TMQfiI/AAAAAAAAAGg/AuZtOzZjG-U/s1600/add_buss_method.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 122px;" src="http://2.bp.blogspot.com/_fmvjrARTMYo/TD4H6TMQfiI/AAAAAAAAAGg/AuZtOzZjG-U/s320/add_buss_method.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5493837293604077090" /></a><br /><br />The method will be defined in the interface and method stub created in the implementation. Now you can edit the code like this:<br /><br /><pre class="prettyprint"><br />@Stateless<br />public class SalesSessionBean implements SalesSessionLocal {<br /><br />@PersistenceContext<br />private EntityManager em;<br /><br />public List<company> getAllCompanies() {<br />List<company> companies = em.createNamedQuery("Company.getAllCompanies").getResultList();<br />return companies;<br />}<br />}<br /></pre><br /><br />Notice that we defined EntityManager which is a class which manages Persistance Context. Persistance Context is basket managing your Entities(objects representing Company, Product...). Classes which are managed by the Entity Manager are our Entity Beans. In the method you can see that we all calling Named Query which we have created before.<br /><br /><h3>Backing Beans</h3><br />Now we will create a middle layer between the Session Bean and JSP site representing the GUI - this layer is a Backing Bean. Backing bean is a Java class which manages and is accessible from the actual JSP page. Create new class in the Web Module (New -> Java Class) and name it SalesBack. Now here is the implementation:<br /><br /><pre class="prettyprint"><br />public class SalesBack {<br /><br />@EJB<br />SalesSessionLocal ssl;<br /><br />public List&lt;company&gt; getAllCompanies(){<br />return ssl.getAllCompanies();<br />}<br />}<br /></pre class="prettyprint"><br /><br /><br /><br />You can see that the class basically references the Session Bean (Be careful you have to reference the interface, not the actual implementation). Than in the method we simply calling the method of the Session Bean. From this it seems that this layer is not needed, but actually it is quiet helpful as you will see later.<br /><br /><br /><br /><h3>Faces configuration</h3><br /><br />In order to be able to use just create Backing Bean in your JSP pages, you will need to perform some changes to <b>faces-config.xml</b> file. Open the file and add the following into the faces-config element:<br /><br /><br /><br /><pre class="prettyprint"><br />&lt;managed-bean&gt;<br />&lt;managed-bean-name&gt;sales&lt;/managed-bean-name&gt;<br />&lt;managed-bean-class&gt;sales.back.SalesBack&lt;/managed-bean-class&gt;<br />&lt;managed-bean-scope&gt;session&lt;/managed-bean-scope&gt;<br />&lt;/managed-bean&gt;<br /></pre><br />Be sure to check the Backing Bean class (including the package name). Later you can reference this Backing Bean as "sales" in your JSP page.<br /><br /><h3>JSF Page</h3><br />Now we will show what advantages/components brings Java Server Faces and how to use them. First we will create simple page just showing a table of all companies in stored in the DB. On the Web Module create a new JSP page with JSF. (New -> JSF JSP Page). After you create the page you can see that it contains two @taglib directives referencing the JSF framework TAGs.<br />JSP technology can be extended by "custom tags". When we register the prefixes using the taglib directory, we introduce all the custom tags which come with the JSF framework. First group with prefix "f" named "Core" references all the components which are independent on the renderer (e.g. converters, validators). The second group with prefix "h" named "HTML" introduces all the HTML tags and components that brings JSF to create nice GUI and functional GUI (buttons, tables, grids...).<br />OK, so now lets put in the code which will show the table of companies.<br /><pre class="prettyprint"><br />&lt;h1&gt;&lt;h:outputText value="Companies List"/&gt;&lt;/h1&gt;&lt;h:dataTable value="#{sales.allCompanies}" var="item"&gt;<br />&lt;h:column&gt;<br />&lt;f:facet name="header"&gt;&lt;h:outputText value="Name"/&gt;&lt;/f:facet&gt;<br />&lt;h:outputText value="#{item.name}"/&gt;<br />&lt;/h:column&gt;<br />&lt;h:column&gt;<br />&lt;f:facet name="header"&gt;&lt;h:outputText value="Description"/&gt;&lt;/f:facet&gt;<br />&lt;h:outputText value="#{item.description}"/&gt;<br />&lt;/h:column&gt;<br />&lt;/h:dataTable&gt;<br /></pre><br /><br />The main advantage of JSF is that it lets us bind the content of some HTML components to the properties/fields in the Backing Bean. Because in our Backing Bean we had a method called "getAllCompanies" than here we can reference the result of this method as "#{sales.allCompanies}". This binding is done on the "<h:dataTable>" component by setting the <b>value</b> attribute. Notice that the second attribute <b>var</b> lets you set the "name" for one row of the binded collection. Later in the columns definitions you can address one company in the collection by this name (here "item").<br /><br /><h3>Faces Servlet configuration in web.xml</h3><br />Ok now that you have created the JSP file is time to try it. Before you will have to tell the application server, that if the user navigates to your page, the page contains Faces elements and has to be processed using the Faces Servlet. Open the <b>web.xml</b> and alter the Faces Servlet settings this way:<br /><br /><pre class="prettyprint"><br />&lt;servlet&gt;<br />&lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;<br />&lt;servlet-class&gt;javax.faces.webapp.FacesServlet&lt;/servlet-class&gt;<br />&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;<br />&lt;/servlet&gt;<br />&lt;servlet-mapping&gt;<br />&lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;<br />&lt;url-pattern&gt;*.jsf&lt;/url-pattern&gt;<br />&lt;/servlet-mapping&gt;<br /></pre><br /><br />Important part is the Mapping configuration. Basically you are saying that each file ending <b>jsf</b> will be processed by the Faces Servlet. Now if the name of the file you created was "companies.jsp", than in the browser you will reference it by "companies.jsf". Now run the project, and in the browser type the path to "companies.jsf" and you should get following result.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_fmvjrARTMYo/TD9LDPu1KxI/AAAAAAAAAGo/CwdLx24ltRc/s1600/example_1.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 118px;" src="http://3.bp.blogspot.com/_fmvjrARTMYo/TD9LDPu1KxI/AAAAAAAAAGo/CwdLx24ltRc/s320/example_1.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494192589549939474" /></a><br /><br />Obviously the companies table is empty. So go ahead and using NetBeans (Services -> Databases) run some SQL INSERT statements and you should be able to see the inserted data in your table.<br /><br /><pre class="prettyprint"><br />INSERT INTO SALES.COMPANY (companyname, companydescription) values('First company', 'Sales bananas');<br />INSERT INTO SALES.COMPANY (companyname, companydescription) values('Second company', 'Sales oranges');<br /></pre><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fmvjrARTMYo/TEBlaHdpOwI/AAAAAAAAAHA/QnJTpbwvmgs/s1600/sample_data.PNG"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 277px; height: 166px;" src="http://4.bp.blogspot.com/_fmvjrARTMYo/TEBlaHdpOwI/AAAAAAAAAHA/QnJTpbwvmgs/s320/sample_data.PNG" border="0" alt=""id="BLOGGER_PHOTO_ID_5494503044746394370" /></a><br />OK in the next post I will finish this application and provide some additional functionality to edit the company details and add and remove products of a company. <br /><br /><a href="{{ site.baseurl }}{% post_url 2010-07-14-enterprise-java-netbeans %}"><b>PART 1</b></a><br /><a href="{{ site.baseurl }}{% post_url 2010-07-16-netbeans-enterprise-java-2-some-more-of %}"><b>PART 2</b></a><br /><a href="{{ site.baseurl }}{% post_url 2010-07-29-j2ee-netbeans-jsf-persistence-api-part %}"><b>PART 3</b></a><br />