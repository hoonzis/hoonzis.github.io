---
layout: post
title: Common.Logging and compatibility with other libraries
date: '2012-04-21T07:28:00.000-07:00'
author: Jan Fajfr
tags:
- ".NET"
- ASP.NET
- C#
modified_time: '2014-06-26T14:21:48.886-07:00'
thumbnail: http://lh5.ggpht.com/-j2tpEoC1B1o/T40P8SuuK5I/AAAAAAAAATo/QPH01JPFxQM/s72-c/image_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-6833152346207990177
blogger_orig_url: http://hoonzis.blogspot.com/2012/04/commonlogging-and-compatibility-with.html
---

<p>It has been the second time since I have run into the issue of configuring correctly Common.Logging on my project. So what is the problem? Let's start with the basics:</p> <p><strong>Common.Logging</strong> should be a generic interface for logging which can be used by other frameworks and libraries to perform logging. The final user (you or me) uses several frameworks in his final application and if all of these frameworks will use different logging framework it will turn into configuration nightmare.So our favorite frameworks such as Spring.NET, Quartz.NET are using Common.Logging. This interface in turn uses a concrete logging framework to perform the logging (the act of writing the log lines to somewhere).</p> <p>Typical scenario can be for instance <strong>Common.Logging</strong> and <strong>Log4Net</strong> combination. In our application configuration file (<em>web.config or app.config)</em> we have to configure Common.Logging to use the Log4Net and than we can continue with the Log4Net configuration specifying what should be logged.</p><pre class="prettyprint"><br />&lt;common&gt;<br />&lt;logging&gt;<br />  &lt;factoryAdapter type="Common.Logging.Log4Net.Log4NetLoggerFactoryAdapter, Common.Logging.Log4Net"&gt;<br /> &lt;arg key="configType" value="INLINE" /&gt;<br />  &lt;/factoryAdapter&gt;<br />&lt;/logging&gt;<br />&lt;/common&gt;<br /><br />&lt;log4net&gt;<br />&lt;appender name="ConsoleAppender" type="log4net.Appender.ConsoleAppender"&gt;<br />  &lt;layout type="log4net.Layout.PatternLayout"&gt;<br /> &lt;conversionPattern value="%date %-5level %logger - %message%newline"/&gt;<br />  &lt;/layout&gt;<br />&lt;/appender&gt;<br />&lt;/log4net&gt;<br /></pre><p>My general problem is that <strong>Common.Loggin.Log4Net</strong> <strong>facade is looking for a concrete version of the Log4Net library</strong>. Concretely the version: 'log4net (= 1.2.10)'. That is not a problem if you are not using some other framework which depends on higher version of Log4Net. <br />In my case the <strong>le_log4net</strong> library (the <a href="https://logentries.com/doc/appharbor/">logentries</a> library) is using log4net 2.0. So if you are using NuGet, you might obtain the following exception while adding the references:</p><br /><p><a href="http://lh4.ggpht.com/-LUsxB0LPQ_o/T40P7mf0eyI/AAAAAAAAATg/-ac99BOYZSA/s1600-h/image2.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/-j2tpEoC1B1o/T40P8SuuK5I/AAAAAAAAATo/QPH01JPFxQM/image_thumb.png?imgmax=800" width="244" height="90"></a></p><br /><p>The similar thing might happen if you just decide to use the latest Log4Net by default. Then you might get an exception when initializing Spring.NET context or starting the Quartz.NET scheduler:</p><br /><p><em>Could not load file or assembly 'log4net, Version=1.2.0.30714, Culture=neutral, PublicKeyToken=b32731d11ce58905' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)</em></p><br /><h3>Solution 1: Ignore NuGet, define Runtime Binding</h3><br /><p>One way to get around this is to define runtime assembly binding. But this solution forces you to add the reference to log4net manually. NuGet controls the version and wont let you at references on the fly the way that you would. So to get over add the latest Common.logging.Log4net façade and Log4Net version 2 (which you need for some reason). Than you have to define the assembly&nbsp; binding in the configuration file.</p><pre class="prettyprint"><br />&lt;runtime&gt;<br />&lt;assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1"&gt;<br />  &lt;dependentAssembly&gt;<br /> &lt;assemblyIdentity name="Common.Logging" publicKeyToken="af08829b84f0328e"/&gt;<br /> &lt;bindingRedirect oldVersion="1.2.0.0" newVersion="2.0.0.0"/&gt;<br />  &lt;/dependentAssembly&gt;<br />&lt;/assemblyBinding&gt;<br />&lt;/runtime&gt;<br /></pre><br /><h3>Solution 2: Just use the older version of Log4Net (1.2.10)</h3><br /><p>If you do not have libraries that are dependent on Log4Net version 2.0.0 than just remember to always use log4net 1.2.10. This is the version which Common.Logging.Log4Net is looking for. Or just let NuGet manage it for you. You can add Common.Logging.Log4Net via NuGet and it will automatically load the correct version of Log4Net.</p><br /><h3>Solution 3: Try other logging library for instance NLog</h3><br /><p>This actually is not a real solution. I have experienced similar issues while using NLog, concretely try to use the latest NLog library with the Common.Logging.Nlog façade and you will obtain something similar to:</p><br /><p><em>{"Could not load file or assembly 'NLog, Version=1.0.0.505, Culture=neutral, PublicKeyToken=5120e14c03d0593c' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)":"NLog, Version=1.0.0.505, Culture=neutral, PublicKeyToken=5120e14c03d0593c"}</em></p><br /><p>The solution here is similar, you will have to define Runtime Binding:</p><pre class="prettyprint"><br />&lt;runtime&gt;<br />&lt;assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1"&gt;<br />  &lt;dependentAssembly&gt;<br /> &lt;assemblyIdentity name="NLog" publicKeyToken="5120e14c03d0593c" culture="neutral" /&gt;<br /> &lt;bindingRedirect oldVersion="0.0.0.0-2.0.0.0" newVersion="2.0.0.0" /&gt;<br />  &lt;/dependentAssembly&gt;<br />&lt;/assemblyBinding&gt;<br />&lt;/runtime&gt;</pre><br /><p>What was interesting here, is that NuGet actually took care of this for me. I have just added the Common.Logging.NLog façade and I guess NuGet spotted that I have already NLog 2 and that this Runtime Binding is necessary. If you look at the <a href="http://msdn.microsoft.com/en-us/library/eftw1fys(v=vs.71).aspx">documentation of bindingRedirect</a> you will see, that we have the right to specify the range of versions in the oldVersion attribute. Here all the version will be bound to the 2.0.0.0 version.</p><br /><h3>Summary</h3><br /><p>Anyway NLog and Log4Net are both cool logging frameworks, just use the one you prefer. As I have showed&nbsp; above it is possible to use them together with Common.Logging it just takes a few more lines to configure it correctly.</p><a style="display: none" href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=honga" rel="tag">CodeProject</a>