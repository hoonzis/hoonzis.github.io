---
layout: post
title: NumberFormatInfo ReadOnly
date: '2011-02-23T14:18:00.000-08:00'
author: Jan Fajfr
tags:
- ".NET"
- C#
modified_time: '2014-06-27T02:55:19.237-07:00'
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-7285824319203390560
blogger_orig_url: http://hoonzis.blogspot.com/2011/02/i-was-running-traditional-ms-visual.html
---

<p>I was running traditional MS Visual Studio 2008 Unit Tests and the test of the following method was always failing. On the first look I did not why but from the fact that when I placed the breakpoint on the return line it never got hit, I figured out that there must have been exception before.</p><p>As this was running in the Unit Test, the exception was not thrown but just shown in the Error Message column in the Test Results table.</p><br /><pre class="prettyprint"><br />public String GetBalance(String globalBalance){<br />  NumberFormatInfo formatInfo = NumberFormatInfo.InvariantInfo;<br />  formatInfo.CurrencySymbol = "$";<br />  return globalBalance.ToString("C", formatInfo);<br />}<br /></pre><p>I obtained the following Error Message:</p><pre class="prettyprint"><br />System.InvalidOperationException: Instance is read-only..<br /></pre>Ok now it was clear. I was trying to change the InvariantFormat which surely was not allowed. The right way of doing things would be:<br /><pre></pre><p>Since I was looking at the Stack Trace, I decided just to look a bit deeper:</p><pre class="prettyprint"><br />at System.Globalization.NumberFormatInfo.VerifyWritable()<br />   at System.Globalization.NumberFormatInfo.set_CurrencySymbol(String value)<br />   at <br /></pre><p>Lets take a look at the source code of the NumberFormatInfo class and search for the CurrencySymbol property, for example <a href="http://reflector.webtropy.com/default.aspx/Net/Net/3@5@50727@3053/DEVDIV/depot/DevDiv/releases/whidbey/netfxsp/ndp/clr/src/BCL/System/Globalization/NumberFormatInfo@cs/1/NumberFormatInfo@cs">at this site></a></p><pre class="prettyprint"><br />public String CurrencySymbol {<br />  get { return currencySymbol; }<br />  set {<br />    VerifyWritable();<br />    if (value == null) {<br />      throw new ArgumentNullException("CurrencySymbol",<br />      Environment.GetResourceString("ArgumentNull_String"));<br />    }<br />    currencySymbol = value;<br />  }<br />}<br /><br />internal bool isReadOnly=false;<br /><br />private void VerifyWritable() {<br />  if (isReadOnly) {<br />    throw new<br />InvalidOperationException(Environment.GetResourceString("InvalidOperation_ReadOnly"));<br />  }<br />}<br /><br />public static NumberFormatInfo ReadOnly(NumberFormatInfo nfi) {<br />  if (nfi == null) {<br />    throw new ArgumentNullException("nfi");<br />  }<br />  if (nfi.IsReadOnly) {<br />    return (nfi);<br />  }<br />  NumberFormatInfo info = (NumberFormatInfo)(nfi.MemberwiseClone());<br />  info.isReadOnly = true;<br />  return info;<br />}<br /></pre><p>Ok so any time the property is set (any of the properties of NumberInfoFormat) the VerifyWritable method is called. And this method just checks the private field isReadOnly. This makes sence. This property is set up by the ReadOnly static method. So any time you will need a read only instance of NumberFormatInfo you can just call:</p><pre class="prettyprint"><br />NumberFormatInfo myReadOnlyInstance = NumberFormatInfo.ReadOnly(formatInfo);<br /></pre>