---
layout: post
title: SharePoint - AlterTask method problem
date: '2009-12-28T05:25:00.000-08:00'
author: Jan Fajfr
tags:
- SharePoint
- Workflow
modified_time: '2010-02-07T05:11:43.965-08:00'
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-1721662806542422668
blogger_orig_url: http://hoonzis.blogspot.com/2009/12/sharepoint-altertask-method-problem.html
---

During the development of a simple sequential workflow in SharePoint I came across "OnTaskChanged not firing" issue.<br /><br />I had this problem already couple times, so I tried to check the usual causes of this problem:<br /><br />1) Usually in sequential workflow you hava a CreateTask or CreateTaskWithContentType activity, which is followed by OnTaskChanged activity in the loop. <br /><br /><span style="font-weight:bold;">Correlation token, TaskId, TaskProperties</span> of these two activities have to match - so your task can be "wired" together with OnTaskChanged activity.<br /><br /><br />2)The last time I was having this issue was that one of my assemblies in GAC was not up to date. In that time I found this in my LOG:<br /><br /><span style="font-style:italic;"><br />System.TypeLoadException: Could not load type 'BaseClassesLibrary.Library.MailLibrary' from assembly 'BaseClassesLibrary, Version=1.0.0.0, Culture=neutral, PublicKeyToken=cfc77ab1c27103f4'.     at RequestWorkflowASP.ITApproveActivity.ITApproveTask_MethodInvoking(Object sender, ExternalDataEventArgs e)     at System.Workflow.ComponentModel.Activity.RaiseGenericEvent[T](DependencyProperty dependencyEvent, Object sender, T e)     at System.Workflow.Activities.HandleExternalEventActivity.RaiseEvent(Object[] args)     at System.Workflow.Activities.HandleExternalEventActivity.System.Workflow.ComponentModel.IActivityEventListener<System.Workflow.ComponentModel.QueueEventArgs>.OnEvent(Object sender, QueueEventArgs e)     at System.Workflow.ComponentModel.ActivityExecutorDelegateInfo`1.ActivityExec...<br /></span><br /><br />So I was searching for something similar(Missing any assemblies)….no result.<br /><br />So finally after hours of digging I found the solution. The task is displayed as ASP page. In the code-behind of this page I change the SharePoint task item (because taks is a simple SPListItem) by calling the <span style="font-weight:bold;">SPWorkflowTask.AlterTask(...) </span> method.<br /><br /><pre class="brush: csharp"><br />//Create the hashtable which will be populated to ExtendedProperties of task AfterProperties<br />Hashtable taskHash = new Hashtable();<br /><br />//Fill the values of the HashTable<br />taskHash["hwDescription"] = txbHWDescription.Text;<br />taskHash["swDescription"] = txbSWDescription.Text;<br />taskHash["částka"] = txbPrice.Text;<br /><br />//Call the AlterTask method to populate AfterProperties<br />SPWorkflowTask.AlterTask(_spListItem, taskHash, true);<br /></pre><br /><br />The problem was in the line: <span style="font-weight:bold;">taskHash["částka"]</span> where I have used some Czech alphabet characters to specify the property. SharePoint couldn't alter the task correctly, so my OnTaskChanged event didn't fire.<br /><br />I try to avoid using the Czech alphabet in my code and this was just "temporary" solution, which somehow stayed there. If I would keep some coding best practices and never left temporary solutions, I could have saved myself couple hours of time :).<br /><br />Strange is the fact, that I didn't receive any exception in the SharePoint LOG.<br />Just the OnTaskChanged was not firing.