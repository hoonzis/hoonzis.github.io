---
layout: post
title: Bind-able layer for Bing Maps
date: '2012-01-16T15:36:00.001-08:00'
author: Jan Fajfr
tags:
- Maps
- Silverlight
- WP7
modified_time: '2014-06-26T14:40:37.365-07:00'
blogger_id: tag:blogger.com,1999:blog-1710034134179566048.post-8163684139737279068
blogger_orig_url: http://hoonzis.blogspot.com/2012/01/bind-able-layer-for-bing-maps.html
---

I had a special requirement on showing items on Bing Map.<br /><br />I needed to show a collection of collections of objects - in this case bike routes. Actually each route was composed of collection of routes (which could be interconnected at some places).<br /><br />This cannot be achieved only by <b>MapItemsControl</b> - which can render only one dimensional collection.<br /><br />So what I really need was to add dynamically a collection of <b>MapItemsControl</b> to the map.<br /><br />Instead of using <b>MapItemsControl</b> I have decided to use the <b>MapLayer</b> class. I have created a new layer, which exposes a <b>DependencyProperty</b> "Routes".<br /><br />This property can be bound to a two dimensional collection. I use <b>List</b> of Lists, but I guess I should have used <b>IEnumerable</b> to  make the usage more general. When the collection changes, the routes are drawn to the card, by creating <b>MapPolyline</b> objects.<br /><br />Of course a similar class could be created for <b>Pushpins</b> - and for displaying a set of set's of places.<br /><br />When taken further, actually this approach could even expose a Template which could be set to specify how each item of the group will be rendered.<br /><br />Here is the code:<br /><br /><pre class="prettyprint"><br />public class BikeRoutesLayer : MapLayer<br />{<br />    private static Color[] _colors = { Colors.Blue, Colors.Green, Colors.Orange,Colors.Gray };<br /><br />    public List&lt;List&lt;LocationCollection&gt;&gt; Routes<br />    {<br />        get { return (List&lt;List&lt;LocationCollection&gt;&gt;)GetValue(RoutesProperty); }<br />        set { SetValue(RoutesProperty, value); }<br />    }<br />    public static readonly DependencyProperty RoutesProperty =<br />        DependencyProperty.Register("Routes", typeof(List&lt;List&lt;LocationCollection&gt;&gt;), typeof(BikeRoutesLayer), new PropertyMetadata(new PropertyChangedCallback(RoutesChangedCallBack)));<br />    <br />    static int i = 0;<br />    private static void RoutesChangedCallBack(DependencyObject sender, DependencyPropertyChangedEventArgs args)<br />    {<br />        var layer = sender as BikeRoutesLayer;<br /><br />        var list = args.NewValue as List&lt;List&lt;LocationCollection&gt;&gt;;<br /><br />        if (list != null)<br />        {<br />            foreach (var bikeRoute in list)<br />            {<br />                foreach (var route in bikeRoute)<br />                {   <br />                    MapPolyline line = new MapPolyline();<br />                    line.Locations = route;<br />                    line.StrokeThickness = 1;<br />                    line.Stroke = new SolidColorBrush(_colors[i%_colors.Length]);<br />                    layer.Children.Add(line);<br />                }<br />                i++;<br />            }<br />        }<br />    }<br />}</pre>